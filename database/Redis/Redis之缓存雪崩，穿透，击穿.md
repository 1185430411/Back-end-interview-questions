[TOC]

## 缓存雪崩

缓存雪崩，是指：系统刚上限时，数据还没有加载到缓存中；或者在某一个时间点，缓存中的数据大面积失效了，此时大量的查询请求落在数据库服务器上，造成数据库CPU和内存压力过大，甚至宕机

![](C:\Users\2019.10\Desktop\QQ图片20200224215430.png)

解决方案：

- 使用分布式锁或者分布式队列来限制数据库请求数量，这样可以一定程度上保护数据库服务器。但是加锁所导致吞吐量下降。
- 使缓存的过期时间尽可能分散，比如允许过期时间为一个范围内的一个随机值
- 使用二级缓存，A设置为原始缓存，失效时间为短期，B设置为二级缓存，失效时间更长一点。这样在A雪崩时，B就可以发挥作用

## 缓存穿透

缓存穿透是指：查询一个在数据库中不可能存在的数据，此时缓存miss了，然后再去数据库中进行查询，再miss掉，然后再返回空值，整个过程为了查询一个不可能存在的数据进行了两次无用的查询。这就叫作缓存穿透。一些非法用户可能会制造大量的缓存穿透来攻击热点接口，所以这是需要注意的。

解决方案：

- 使用分布式锁或者分布式队列来限制数据库请求数量，这样可以一定程度上保护数据库服务器。但是治标不治本
- 允许缓存存储空值。当数据库返回空值时，也可以将空值设置到缓存中，下一次再请求时就直接在缓存中命中，避免了一次缓存穿透。但是这样的机制会让缓存体积变大。
- 使用布隆过滤器。布隆过滤器是一个类似于HashSet的结构。将所有可能的数据哈希到这个结构中，当对一个不可能的数据请求查询时，会直接被布隆过滤器过滤掉，不会到达数据库层

## 缓存击穿

缓存击穿是指：热点key在某些特殊的场景时间内恰好失效了，导致有大量请求进入数据库中，增加数据库服务器的压力

其实缓存击穿和缓存雪崩差不多，只不过缓存雪崩描述的是大量key，而缓存击穿描述的是热点key

解决方案：

- 使用分布式锁或者分布式队列来限制数据库请求数量，这样可以一定程度上保护数据库服务器。但是加锁所导致吞吐量下降。
- 对于这些热点key，过期时间可以设置为无限长

## 缓存降级

缓存降级是指当访问量剧增，服务出现问题的时候，系统可以牺牲非核心服务，来保证核心服务的正常执行。系统可以根据一些关键数据进行自动降级，也可以配置实现人工降级。

关于缓存降级，前年的双十一，买东西是无法修改地址的，只能使用默认地址发货，而支付等功能是没有问题的。这就是个缓存降级的表现，牺牲修改地址等非核心业务，保障支付这个核心业务！

## 缓存预热

缓存预热就是系统刚上线时，把一部分的数据提前加载到缓存中，这样就避免一开始的时候大量请求全部落在数据库上，增加DB的压力
